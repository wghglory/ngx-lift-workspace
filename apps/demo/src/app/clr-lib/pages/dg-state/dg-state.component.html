<cll-page-container [title]="'dgState'" customClass="space-y-9">
  <!-- Overview -->
  <p>
    The <code>dgState</code> operator is an RxJS operator designed to manage Clarity Datagrid state transformations with
    intelligent debouncing and duplicate filtering. It assesses changes in datagrid filters and handles API trigger
    events efficiently. When filters are modified, the operator introduces a 500ms debounce before initiating the API
    call, preventing excessive requests during rapid typing. For actions such as sorting or pagination, the API call is
    made promptly without delay. The operator also provides an optional parameter to control the use of
    <code>distinctUntilChanged</code>. When enabled (default: <code>true</code>), it ensures that no API call is
    initiated if the datagrid state remains the same, preventing redundant requests.
  </p>

  <!-- Examples Section -->
  <section class="space-y-4">
    <h2>Examples</h2>

    <article class="space-y-3">
      <h3>Example 1: Basic Usage</h3>
      <p>Use <code>dgState</code> in your observable pipeline to manage datagrid state changes efficiently:</p>
      <app-code-block [code]="typescriptCode" lang="typescript" />
      <p>Assume we have an API returning the following shape of data for a server-driven datagrid:</p>
      <app-code-block [code]="dataCode" lang="json" />
    </article>

    <article class="space-y-3">
      <h3>Example 2: Template Implementation with Type Safety</h3>
      <p>Use async pipe with <code>&#64;if</code> for better type safety:</p>
      <app-code-block [code]="htmlCode" lang="html" />
    </article>

    <article class="space-y-3">
      <h3>Example 3: Alternative Template Implementation</h3>
      <p>Use the async pipe directly in your template:</p>
      <app-code-block [code]="secondHtmlCode" lang="html" />
    </article>

    <article class="space-y-3">
      <h3>Example 4: Live Example</h3>
      <p>Below is a working example of a server-driven datagrid using the <code>dgState</code> operator:</p>
      <app-user-datagrid />
    </article>
  </section>

  <cll-callout>
    <p>
      You can use the <a class="underline" [routerLink]="['/clr-lift/utilities/datagrid']">convertToHttpParams</a>
      utility function to convert the datagrid state into HTTP parameters. See the documentation for more details.
    </p>
  </cll-callout>

  <!-- API Reference -->
  <section class="space-y-4">
    <h2>API Reference</h2>
    <div class="space-y-4">
      <div class="space-y-3">
        <h3>dgState</h3>
        <p>
          RxJS operator for handling Clarity Datagrid state transformations with debouncing and optional
          distinctUntilChanged behavior.
        </p>

        <h4>Signature</h4>
        <app-code-block [code]="signatureCode" lang="typescript" />

        <h4>Parameters</h4>
        <ul class="list-disc space-y-2 ml-6">
          <li class="space-y-1">
            <code>enableDistinctUntilChanged?: boolean</code>
            <div class="ml-4">
              <p class="text-sm !mt-1">
                <em>(Optional)</em> Whether to enable distinctUntilChanged filtering. Defaults to <code>true</code>.
                When <code>true</code>, suppresses duplicate states. When <code>false</code>, allows API calls even for
                identical states.
              </p>
            </div>
          </li>
        </ul>

        <h4>Returns</h4>
        <p class="text-sm">
          A RxJS pipe function that transforms an observable of <code>ClrDatagridStateInterface | null</code>.
        </p>

        <h4>Behavior</h4>
        <ul class="list-disc space-y-1 ml-6 text-sm">
          <li>Adds a 500ms debounce when filters change (to avoid excessive API calls during rapid typing)</li>
          <li>Makes API calls promptly for sorting or pagination actions (no debounce)</li>
          <li>
            Optionally filters out duplicate consecutive states when <code>enableDistinctUntilChanged</code> is
            <code>true</code>
          </li>
          <li>Starts with a null state to handle initial load scenarios</li>
        </ul>
      </div>
    </div>
  </section>
</cll-page-container>
